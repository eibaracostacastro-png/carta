<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Carta para licencia D1 / D2 / D3</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f3f3;
      margin: 0;
      padding: 20px;
    }

    .contenedor {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
    }

    .formulario {
      background: #ffffff;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      font-size: 14px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 8px;
    }

    .form-row > div {
      flex: 1;
      min-width: 180px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 2px;
      font-size: 12px;
    }

    input, select, textarea {
      width: 100%;
      padding: 4px 6px;
      box-sizing: border-box;
      font-size: 13px;
    }

    input[readonly] {
      background-color: #f7f7f7;
    }

    button {
      margin-top: 8px;
      padding: 8px 14px;
      font-size: 14px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
    }

    #btnGenerar {
      background: #007bff;
      color: #fff;
    }

    #btnImprimir {
      background: #28a745;
      color: #fff;
      margin-left: 6px;
    }

    .carta-contenedor {
      background: #ffffff;
      padding: 25px 35px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      min-height: 500px;
      margin-top: 10px;
    }

    .carta {
      font-size: 13px;
      line-height: 1.25;
    }

    .carta p {
      margin: 4px 0;
      text-align: justify;
    }

    .carta .firma {
      margin-top: 40px;
      text-align: left;
    }

    .carta .firma p {
      margin: 2px 0;
    }

    @media print {
      body {
        background: #ffffff;
      }
      .formulario, #btnImprimir, #btnGenerar, h1 {
        display: none !important;
      }
      .carta-contenedor {
        box-shadow: none;
        margin: 0;
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <h1>Carta para Solicitud de Licencia D1 / D2 / D3</h1>

    <div class="formulario">
      <div class="form-row">
        <div>
          <label for="lugar">Lugar donde se emite</label>
          <input type="text" id="lugar" value="Guápiles, Pococí, Limón">
        </div>
        <div>
          <label for="sedeRegional">Sede Regional de Educación Vial</label>
          <input type="text" id="sedeRegional" value="Guápiles">
        </div>
        <div>
          <label for="licenseType">Tipo de licencia</label>
          <select id="licenseType">
            <option value="D1">D1 - Liviano de carga</option>
            <option value="D2">D2 - Pesado de carga</option>
            <option value="D3">D3 - Articulado / equipo especial</option>
          </select>
        </div>
      </div>

      <hr>

      <h3>Datos del patrón / empresa (fijos)</h3>
      <div class="form-row">
        <div>
          <label for="nombrePatron">Nombre del patrón</label>
          <input type="text" id="nombrePatron" value="Neal Ariel Acosta Castro" readonly>
        </div>
        <div>
          <label for="cedulaPatron">Cédula del patrón</label>
          <input type="text" id="cedulaPatron" value="7-0262-0124" readonly>
        </div>
      </div>

      <div class="form-row">
        <div>
          <label for="nombreEmpresa">Nombre de la empresa</label>
          <input type="text" id="nombreEmpresa" value="Inversiones Acosta Durán del Caribe S.A." readonly>
        </div>
        <div>
          <label for="personeria">Personería jurídica</label>
          <input type="text" id="personeria" value="3-101-899284" readonly>
        </div>
      </div>

      <hr>

      <h3>Datos del trabajador</h3>
      <div class="form-row">
        <div>
          <label for="nombreTrabajador">Nombre del trabajador</label>
          <input type="text" id="nombreTrabajador" placeholder="">
        </div>
        <div>
          <label for="cedulaTrabajador">Cédula del trabajador</label>
          <input type="text" id="cedulaTrabajador" placeholder="">
        </div>
      </div>

      <div class="form-row">
        <div>
          <label for="direccionTrabajador">Vecino de</label>
          <input type="text" id="direccionTrabajador" placeholder="">
        </div>
        <div>
          <label for="correoTrabajador">Correo electrónico</label>
          <input type="email" id="correoTrabajador" placeholder="">
        </div>
        <div>
          <label for="telefonoTrabajador">Teléfono</label>
          <input type="text" id="telefonoTrabajador" placeholder="">
        </div>
      </div>

      <div class="form-row">
        <div>
          <label for="puestoExtra">Puesto específico (opcional)</label>
          <input type="text" id="puestoExtra" placeholder="Ej.: Operador de montacargas">
        </div>
      </div>

      <hr>

      <h3>Opciones de fecha de inicio laboral</h3>
      <div class="form-row">
        <div>
          <label for="modoFecha">Modo de fecha</label>
          <select id="modoFecha">
            <option value="auto">Automática (1 mes y 15 días antes de hoy)</option>
            <option value="manual">Manual (seleccione la fecha)</option>
          </select>
        </div>
        <div>
          <label for="fechaInicioManual">Fecha de inicio (si es manual)</label>
          <input type="date" id="fechaInicioManual">
        </div>
      </div>

      <button id="btnGenerar">Generar carta</button>
      <button id="btnImprimir" onclick="window.print()">Imprimir</button>
    </div>

    <div class="carta-contenedor">
      <div id="carta" class="carta" contenteditable="true">
        <!-- Aquí se generará la carta -->
      </div>
    </div>
  </div>

  <script>
    function formatearFechaEsp(fecha) {
      const meses = [
        "enero", "febrero", "marzo", "abril", "mayo", "junio",
        "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"
      ];
      const dia = fecha.getDate();
      const mes = meses[fecha.getMonth()];
      const anio = fecha.getFullYear();
      return dia + " de " + mes + " de " + anio;
    }

    function formatearFechaDesdeInput(valor) {
      if (!valor) return "";
      const partes = valor.split("-");
      if (partes.length !== 3) return "";
      const anio = parseInt(partes[0], 10);
      const mes = parseInt(partes[1], 10) - 1;
      const dia = parseInt(partes[2], 10);
      const fecha = new Date(anio, mes, dia);
      return formatearFechaEsp(fecha);
    }

    function calcularFechaInicioLaboralAuto() {
      const hoy = new Date();
      const ms45dias = 45 * 24 * 60 * 60 * 1000; // 1 mes y 15 días aprox.
      const inicio = new Date(hoy.getTime() - ms45dias);
      return formatearFechaEsp(inicio);
    }

    function obtenerTextosPorLicencia(tipo) {
      let textoVehiculo = "";
      let textoDescripcion = "";
      switch (tipo) {
        case "D1":
          textoVehiculo = "vehículos livianos de carga con peso bruto entre 3 y 8 toneladas";
          textoDescripcion = "para los trámites de obtención de la licencia de conducir categoría D1";
          break;
        case "D2":
          textoVehiculo = "vehículos pesados de carga con peso bruto superior a 8 toneladas";
          textoDescripcion = "para los trámites de obtención de la licencia de conducir categoría D2";
          break;
        case "D3":
          textoVehiculo = "vehículos articulados de carga y equipo especial pesado";
          textoDescripcion = "para los trámites de obtención de la licencia de conducir categoría D3";
          break;
      }
      return { textoVehiculo, textoDescripcion };
    }

    document.getElementById("btnGenerar").addEventListener("click", function () {
      const lugar = document.getElementById("lugar").value || "Guápiles, Pococí, Limón";
      const sedeRegional = document.getElementById("sedeRegional").value || "Guápiles";
      const licenseType = document.getElementById("licenseType").value;

      const nombrePatron = document.getElementById("nombrePatron").value;
      const cedulaPatron = document.getElementById("cedulaPatron").value;
      const nombreEmpresa = document.getElementById("nombreEmpresa").value;
      const personeria = document.getElementById("personeria").value;

      const nombreTrabajador = document.getElementById("nombreTrabajador").value || "[Nombre del trabajador]";
      const cedulaTrabajador = document.getElementById("cedulaTrabajador").value || "[Cédula del trabajador]";
      const direccionTrabajador = document.getElementById("direccionTrabajador").value || "[Dirección del trabajador]";
      const correoTrabajador = document.getElementById("correoTrabajador").value || "[Correo del trabajador]";
      const telefonoTrabajador = document.getElementById("telefonoTrabajador").value || "[Teléfono del trabajador]";
      const puestoExtra = document.getElementById("puestoExtra").value;

      const hoy = new Date();
      const fechaHoy = formatearFechaEsp(hoy);

      const modoFecha = document.getElementById("modoFecha").value;
      const fechaManualValor = document.getElementById("fechaInicioManual").value;

      let fechaInicioLaboral = "";
      if (modoFecha === "manual" && fechaManualValor) {
        fechaInicioLaboral = formatearFechaDesdeInput(fechaManualValor);
      } else {
        fechaInicioLaboral = calcularFechaInicioLaboralAuto();
      }

      const { textoVehiculo, textoDescripcion } = obtenerTextosPorLicencia(licenseType);

      const textoPuestoExtra = puestoExtra
        ? `, desempeñando el puesto de ${puestoExtra}`
        : "";

      const cartaHTML = `
        <p style="text-align:right;"><strong>${lugar}, ${fechaHoy}</strong></p>

        <p><strong>Señores:</strong><br>
        <strong>Sede Regional de Educación Vial ${sedeRegional}</strong><br>
        Departamento de Evaluación de Conductores<br>
        Dirección General de Educación Vial<br>
        Ministerio de Obras Públicas y Transportes (MOPT)</p>

        <p><strong>Estimados señores:</strong></p>

        <p>Por medio de la presente, yo, <strong>${nombrePatron}</strong>, cédula de identidad <strong>${cedulaPatron}</strong>,
        en mi condición de <strong>patrón</strong> y representante de la empresa <strong>${nombreEmpresa}</strong>,
        personería jurídica <strong>${personeria}</strong>, hago constar que el(la) señor(a)
        <strong>${nombreTrabajador}</strong>, cédula de identidad <strong>${cedulaTrabajador}</strong>, vecino(a) de
        <strong>${direccionTrabajador}</strong>, correo electrónico: <strong>${correoTrabajador}</strong> y teléfono
        <strong>${telefonoTrabajador}</strong>, labora actualmente para esta empresa desde el día <strong>${fechaInicioLaboral}</strong>.</p>

        <p>Certifico que el(la) señor(a) <strong>${nombreTrabajador}</strong> se desempeña como conductor de
        <strong>${textoVehiculo}</strong>${textoPuestoExtra}, realizando labores habituales de transporte de carga
        para nuestra compañía.</p>

        <p>La presente constancia se emite a solicitud de la parte interesada ${textoDescripcion}
        ante la Dirección General de Educación Vial del MOPT.</p>

        <p>Para los efectos que estime pertinentes, extiendo la presente en <strong>${lugar}</strong>.</p>

        <div class="firma">
          <p>Atentamente,</p>
          <p>&nbsp;</p>
          <p>__________________________________</p>
          <p><strong>${nombrePatron}</strong></p>
          <p>Patrón / Representante de <strong>${nombreEmpresa}</strong></p>
          <p>Cédula: <strong>${cedulaPatron}</strong></p>
        </div>
      `;

      document.getElementById("carta").innerHTML = cartaHTML;
    });

    window.addEventListener("load", function () {
      document.getElementById("btnGenerar").click();
    });
  </script>
</body>
</html>
